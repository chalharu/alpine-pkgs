# Contributor: Mitsuharu Seki <mitsu1986@gmail.com>
# Maintainer: Mitsuharu Seki <mitsu1986@gmail.com>
pkgname=dexidp
# renovate: datasource=github-tags depName=dexidp/dex
pkgver=2.44.0
pkgrel=0
pkgdesc="OpenID Connect (OIDC) identity and OAuth 2.0 provider with pluggable connectors"
url="https://github.com/dexidp/dex"
arch="all"
license="Apache-2.0"
depends=""
makedepends="go"
checkdepends=""
install=""
subpackages="$pkgname-examples:examples"
source="$pkgname-$pkgver.tar.gz::https://github.com/dexidp/dex/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/dex-$pkgver"
options="net"

build() {
	make build
	make examples
}

check() {
	# make test
	return 0
}

package() {
	# Replace with proper package command(s)
	install -Dm755 -t "$pkgdir"/usr/bin/ \
		bin/dex
}

examples() {
	cd "$builddir"
	install -Dm755 -t "$subpkgdir"/usr/bin/ \
		bin/example-app \
		bin/grpc-client
}

sha512sums="
65dfca65501e601c6e8425cbfee65a64db7ad5cd9b759badca694be51a6b03d2a5f78883532dfd88590ceced55c7c5da5bc0f35d75f3bc7c9339c54f589380fc  dexidp-2.44.0.tar.gz
"
