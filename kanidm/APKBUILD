# Contributor: Mitsuharu Seki <mitsu1986@gmail.com>
# Maintainer: Mitsuharu Seki <mitsu1986@gmail.com>
pkgname=kanidm
# renovate: datasource=github-tags depName=kanidm/kanidm
pkgver=1.3.3
pkgrel=0
pkgdesc="Kanidm: A simple, secure and fast identity management platform"
url="https://github.com/kanidm/kanidm"
arch="all"
license="Apache-2.0"
depends=""
makedepends="eudev-dev gcc libc-utils make musl-dev openssl-dev openssl-libs-static pkgconfig rustup"
checkdepends=""
install=""
subpackages="$pkgname-client:client"
subpackages="$pkgname-server:server"
source="$pkgname-$pkgver.tar.gz::https://github.com/kanidm/kanidm/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/kanidm-$pkgver"
options=""

build() {
	rustup-init -y
	. "$HOME/.cargo/env"
    make release/kanidmd
	strip target/release/kanidmd
	make release/kanidm
	strip target/release/kanidm
}

check() {
	# make test
	return 0
}

package() {
	return 0
}

server() {
	cd "$builddir"
	install -Dm755 -t "$subpkgdir"/usr/bin/ \
		target/release/kanidmd
}

client() {
	cd "$builddir"
	install -Dm755 -t "$subpkgdir"/usr/bin/ \
		target/release/kanidm
}

sha512sums="
0e00634964bef76c97c15e129d43350cab8d71ea9504751a2227c0a60edddd004f682213c639aa43d9f192d6e85138aa4e42312b8d8d5c352f02899813ab6fe0  kanidm-1.3.3.tar.gz
"
